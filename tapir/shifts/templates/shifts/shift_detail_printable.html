{% load core %}
{% load i18n %}
{% load shifts %}
{% load utils %}
<style>
    @page {
        size: A4 landscape;
        margin: 0;
    }

    @media print {
        html, body {
            width: 297mm;
            height: 210mm;
        }
    }

    /* Grundlayout: Container füllt Seite */
    .shift-page {
        width: 100%;
        height: 100%;
        padding: 20px;
        box-sizing: border-box;
        font-size: 22px;
        font-family: sans-serif;
    }

    h1 {
        text-align: center;
        margin-top: 10px;
        margin-bottom: 12px;
    }

    /* Jede Slot-Zeile als flex row */
    .slot-row {
        display: flex;
        align-items: center;
        border: 2px solid black;
        padding: 8px 12px;
        margin-bottom: 10px;
        box-sizing: border-box;
        height: 72px; /* reduzierte Höhe, anpassbar */
    }

    .slot-index {
        width: 6%;
        min-width: 60px;
        text-align: center;
        font-weight: bold;
        border-right: 2px solid black;
        padding-right: 12px;
    }

    .slot-info {
        width: 44%;
        padding-left: 12px;
        border-right: 2px solid black;
        text-align: left;
        font-size: 20px;
    }

    .member-info {
        width: 34%;
        padding-left: 12px;
        border-right: 2px solid black;
        text-align: left;
        font-size: 20px;
    }

    .attendance-controls {
        width: 16%;
        display: flex;
        justify-content: space-around;
        align-items: center;
        padding-left: 12px;
    }

    /* Kleine Checkboxen mit Label */
    .att-checkbox {
        display: flex;
        flex-direction: column;
        align-items: center;
        font-size: 14px;
    }

    .att-checkbox input[type="checkbox"] {
        width: 18px;
        height: 18px;
        margin-bottom: 4px;
    }

    .small-text {
        font-size: 18px;
    }

    /* Für den Druck: Seitenfüllend und keine overflow issues */
    .slots-list {
        height: calc(100% - 80px);
        overflow: visible;
    }
</style>
<div class="shift-page">
    <h1>{{ shift.get_display_name }}</h1>
    <div class="slots-list">
        {% for slot in slots %}
            <div class="slot-row">
                <div class="slot-index">#{{ forloop.counter }}</div>
                <div class="slot-info">
                    <div>{{ slot.name }}</div>
                    <div class="small-text">
                        {% if slot.required_capabilities|length > 0 %}
                            {% translate 'Required qualifications: ' %}{{ slot.get_required_capabilities_display }}
                        {% endif %}
                    </div>
                </div>
                <div class="member-info">
                    {% with slot.get_valid_attendance as attendance %}
                        {% if attendance %}
                            <div>
                                {% get_display_name_short attendance.user %}
                                {% if attendance.user.pronouns %}({{ attendance.user.pronouns }}){% endif %}
                                #{{ attendance.user.share_owner.id }}
                            </div>
                            {% if shift.flexible_time %}
                                {% if attendance.custom_time %}
                                    <div class="small-text">{% translate "Expected to come at" %} {{ attendance.custom_time|time:"H:i" }}</div>
                                {% else %}
                                    <div class="small-text">{% translate "Flexible time not specified" %}</div>
                                {% endif %}
                            {% endif %}
                            {% feature_flag_enabled "feature_flags.shifts.shift_partner" as shift_partner_enabled %}
                            {% if shift_partner_enabled and attendance.user.shift_user_data.shift_partner %}
                                <div class="small-text">
                                    ({% translate "Shift partner: " %}{% get_display_name_short attendance.user.shift_user_data.shift_partner.user %}
                                    #{{ attendance.user.shift_user_data.shift_partner.user.get_member_number }})
                                </div>
                            {% endif %}
                            {% if attendance.state == attendance.State.LOOKING_FOR_STAND_IN %}
                                <div class="small-text">({% translate "Looking for a stand-in" %})</div>
                            {% endif %}
                            <div class="small-text">
                                {% if attendance.user.shift_user_data.capabilities|length > 0 %}
                                    {% translate 'Has qualifications: ' %}{{ attendance.user.shift_user_data.get_capabilities_display }}
                                {% endif %}
                            </div>
                        {% endif %}
                    {% endwith %}
                </div>
                <div class="attendance-controls">
                    <label class="att-checkbox">
                        <input type="checkbox" name="attendance_{{ slot.id }}_attended" />
                        <span>Attended</span>
                    </label>
                    <label class="att-checkbox">
                        <input type="checkbox" name="attendance_{{ slot.id }}_missed" />
                        <span>Missed</span>
                    </label>
                    <label class="att-checkbox">
                        <input type="checkbox" name="attendance_{{ slot.id }}_excused" />
                        <span>Excused</span>
                    </label>
                </div>
            </div>
        {% endfor %}
    </div>
</div>
